<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infographic: ภาพรวมโครงการกลุ่มสีเขียว</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <!--
    Narrative & Structure Plan:
    1. Header: Main title of the infographic.
    2. Overall Summary: A section with key metrics (total projects) and a donut chart visualizing the overall status distribution (On Track vs. Completed).
    3. Project Details Grid: A responsive grid layout displaying each of the 15 projects in individual "Material Design" cards.
    4. Card Content: Each card will contain the project title, a clear status badge with an icon, the reason for the status, the proposed actions, and a new AI-powered button.
    5. Gemini API Integration: A "Generate Executive Summary" button on each card that calls the Gemini API to create a concise summary of the project's status and proposals.
    6. Color Palette: Vibrant Green Theme.
    7. Typography: 'Sarabun' for Thai language readability.

    Visualization Selection:
    1. Data: Project Status Distribution. Visualized with a Donut Chart (Chart.js).
    2. Data: Project Details. Visualized with Structured HTML lists.
    3. AI-Generated Content: A modal window will display the text summary generated by the Gemini API.
    -->
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #ECFDF5; 
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        .card-gradient {
            background-image: linear-gradient(to top right, #FFFFFF, #F0FFF0);
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        .status-on-track {
            background-color: #D1FAE5; 
            color: #059669; 
            border: 1px solid #6EE7B7; 
        }
        .status-completed {
            background-color: #D1FAE5; 
            color: #059669; 
            border: 1px solid #6EE7B7; 
        }
        /* Styles for the modal */
        #aiSummaryModal.hidden {
            display: none;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #059669;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-emerald-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-[#047857]">ภาพรวมโครงการกลุ่มสีเขียว</h1>
            <p class="text-lg text-emerald-800 mt-2">สรุปความคืบหน้า ปัญหา และข้อเสนอแนะสำหรับโครงการที่แล้วเสร็จและตามแผน</p>
        </header>

        <section class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="text-center md:text-left">
                    <h2 class="text-2xl font-bold text-[#047857] mb-4">สรุปภาพรวม</h2>
                    <div class="flex justify-center md:justify-start space-x-8">
                        <div class="text-center">
                            <p class="text-5xl font-bold text-[#047857]">15</p>
                            <p class="text-emerald-700">โครงการทั้งหมด</p>
                        </div>
                        <div class="text-center">
                            <p class="text-5xl font-bold text-[#10B981]">11</p>
                            <p class="text-emerald-700">ตามแผน</p>
                        </div>
                        <div class="text-center">
                            <p class="text-5xl font-bold text-[#34D399]">4</p>
                            <p class="text-emerald-700">แล้วเสร็จ</p>
                        </div>
                    </div>
                     <p class="mt-6 text-emerald-800">โครงการในชุดนี้ส่วนใหญ่มีความคืบหน้าตามแผนหรือแล้วเสร็จ ซึ่งแสดงถึงการบริหารจัดการโครงการที่ดี</p>
                </div>
                <div>
                    <div class="chart-container">
                        <canvas id="statusChartV4"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <main class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
            
            <!-- Project Cards Start Here -->
            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">ศึกษาเพื่อยกระดับการให้บริการรถแท็กซี่ให้มีความปลอดภัยและยั่งยืน</h3>
                <div class="mb-4">
                    <span class="status-badge status-completed">
                        <span class="mr-2">✔️</span>แล้วเสร็จ
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> รายงานผลการดำเนินการและประชุม สรุปปิดโครงการเมื่อวันที่ 27 พ.ค. 68</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ผลักดันข้อเสนอเชิงนโยบายตามผลการศึกษา เพื่อดำเนินการต่อไป</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">พัฒนาและยกระดับมาตรฐานผู้ประกอบการขนส่งสินค้าควบคุมอุณหภูมิ (Cold Chain)</h3>
                <div class="mb-4">
                    <span class="status-badge status-completed">
                        <span class="mr-2">✔️</span>แล้วเสร็จ
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> จัดสัมมนาประชาสัมพันธ์โครงการเมื่อวันที่ 26 มีนาคม 2568</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ขยายผลและบังคับใช้มาตรฐาน โดยผลักดันสู่การออกเป็นประกาศหรือกฎระเบียบ</li>
                            <li>ส่งเสริมให้ผู้ประกอบการนำไปใช้ในวงกว้าง</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">พัฒนาระบบการควบคุมกำกับดูแลการขนส่งอันตรายทางถนน</h3>
                <div class="mb-4">
                    <span class="status-badge status-completed">
                        <span class="mr-2">✔️</span>แล้วเสร็จ
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> จัดสัมมนาประชาสัมพันธ์โครงการ เมื่อวันที่ 5 มีนาคม 2568</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ต่อยอดสู่การปฏิบัติ โดยนำองค์ความรู้และระบบสารสนเทศมาใช้ในการกำกับดูแล</li>
                            <li>ใช้หลักสูตร DG TSM ที่พัฒนาขึ้นในการอบรมบุคลากรต่อไป</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">พัฒนาระบบการขอรับใบอนุญาตขับรถระหว่างประเทศผ่านระบบอิเล็กทรอนิกส์</h3>
                <div class="mb-4">
                    <span class="status-badge status-completed">
                        <span class="mr-2">✔️</span>แล้วเสร็จ
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> จัดงานประชาสัมพันธ์เปิดตัวโครงการฯ และเปิดให้บริการผ่านระบบตั้งแต่วันที่ 17 ธันวาคม 2567</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ติดตามและประเมินผลการใช้งานจากประชาชน เพื่อรวบรวมข้อมูลมาปรับปรุงระบบ</li>
                            <li>ประชาสัมพันธ์ช่องทางการให้บริการให้เป็นที่รู้จักอย่างต่อเนื่อง</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">ศึกษาพฤติกรรมการเดินทาง (User Journey) เพื่อจัดทำข้อเสนอแนะเชิงนโยบาย</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> จัดสัมมนาสรุปโครงการเมื่อวันที่ 4 มิถุนายน 2568 และอยู่ระหว่างตรวจรับโครงการ</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ดำเนินการตรวจรับงานงวดสุดท้ายให้แล้วเสร็จ</li>
                            <li>นำผลการศึกษา pilot project ไปดำเนินการต่อไป</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">ศึกษาแนวทางการส่งเสริมให้องค์กรปกครองส่วนท้องถิ่นมีบทบาทในการจัดระบบขนส่งสาธารณะ</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> จัดประชุมคณะกรรมการตรวจรับพัสดุฯ ครั้งที่ 3/2568 เมื่อวันที่ 6 พฤษภาคม 2568 เพื่อพิจารณาตรวจรับงานงวดสุดท้าย</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ผลักดันข้อเสนอเชิงนโยบายตามผลการศึกษา เพื่อดำเนินการต่อไป</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>
            
            <!-- Other project cards follow the same pattern... -->
             <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">จัดทำข้อมูลการเดินรถโดยสารประจำทางเพื่อการวางแผนการเดินทาง (กทม.)</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> ที่ปรึกษาฯ จัดส่งรายงานเบื้องต้น เมื่อวันที่ 8 พฤษภาคม 2568</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>กำกับดูแลให้ที่ปรึกษาดำเนินงานและส่งมอบผลงานในงวดถัดไปตามกรอบเวลาที่กำหนด</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">โครงการนำร่องศึกษาแนวทางการเชื่อมต่อการขนส่งทางถนนกับการขนส่งทางราง</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> อยู่ระหว่างจัดทำ TOR (เส้นทางกรุงเทพฯ – ชุมพร และกรุงเทพฯ – ปากน้ำโพ)</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>กำกับดูแลให้ที่ปรึกษาดำเนินงานและส่งมอบผลงานในงวดถัดไปตามกรอบเวลาที่กำหนด</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">จ้างที่ปรึกษายกระดับแผนพัฒนาสถานีขนส่งสินค้า (Truck terminal)</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> อยู่ระหว่างดำเนินการตามขอบเขตของงานในงวดที่ 2 (กำหนดส่งมอบงานภายในวันที่ 23 มิ.ย. 68)</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>กำกับดูแลให้ที่ปรึกษาดำเนินงานและส่งมอบผลงานในงวดถัดไปตามกรอบเวลาที่กำหนด</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">โครงการศูนย์การขนส่งชายแดนจังหวัดนครพนม</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> มีผลการดำเนินการก่อสร้างในส่วนที่ภาครัฐรับผิดชอบ ความก้าวหน้า ร้อยละ 97.863</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>กำกับดูแลให้ผู้รับเหมาดำเนินงานและส่งมอบผลงานในงวดถัดไปตามกรอบเวลาที่กำหนด</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">พัฒนาระบบเทคโนโลยีสารสนเทศบริหารจัดการขนส่งสินค้าทางถนน</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> อยู่ระหว่างการพัฒนาระบบฯ</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>กำกับดูแลให้ที่ปรึกษาดำเนินงานและส่งมอบผลงานในงวดถัดไปตามกรอบเวลาที่กำหนด</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">พัฒนาระบบรายงานข้อมูลการตรวจสอบรถและพนักงานขับรถประจำวันของ TSM ออนไลน์</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> ข้อมูล ณ 31 พฤษภาคม 2568 มีบุคลากร TSM รายงานในระบบสะสมแล้ว 9,221 ครั้ง</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>นำข้อมูลที่ได้จากระบบมาวิเคราะห์เพื่อหาแนวโน้มความเสี่ยงด้านความปลอดภัย</li>
                            <li>ส่งเสริมให้ผู้ประกอบการที่ยังไม่ได้ใช้งาน หันมาใช้ระบบมากขึ้น</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">ศึกษาพัฒนาระบบข้อมูลขนาดใหญ่เพื่อติดตามประเมินผลและวิเคราะห์ข้อมูลเชิงลึกอุบัติเหตุทางถนน</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> มีการฝึกอบรมเจ้าหน้าที่ ครั้งที่ 1 (27 พ.ค. 68) และ ครั้งที่ 2 (10 มิ.ย. 68)</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>สนับสนุนให้เจ้าหน้าที่ที่ผ่านการอบรมนำระบบและข้อมูลไปใช้ในการวิเคราะห์และวางแผนมาตรการความปลอดภัยทางถนน</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">ออกประกาศ ขบ. บังคับใช้ เพื่อยกระดับมาตรฐานความปลอดภัยรถโดยสาร (UN Regulation)</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> อยู่ระหว่างปรับปรุงร่างประกาศ และนำเสนอท่าน อขบ. เห็นชอบในหลักการเรียบร้อยแล้ว เมื่อ 26 พ.ค. 68</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ดำเนินการในขั้นตอนที่เหลือเพื่อนำร่างประกาศฯ ไปประกาศในราชกิจจานุเบกษาเพื่อให้มีผลบังคับใช้โดยเร็ว</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col card-gradient transition-transform transform hover:scale-105 hover:shadow-2xl">
                <h3 class="text-xl font-bold text-[#047857] mb-3 project-title">ขับเคลื่อนมาตรการเปลี่ยนรถตู้เป็นมินิบัส</h3>
                <div class="mb-4">
                    <span class="status-badge status-on-track">
                        <span class="mr-2">✅</span>ตามแผน
                    </span>
                </div>
                <div class="text-sm space-y-3 flex-grow">
                    <p class="project-details"><strong class="text-emerald-900">สถานะ:</strong> ข้อมูล ณ พฤษภาคม 2568 มีรถตู้ระหว่างจังหวัด 3,178 คัน และมีมินิบัสระหว่างจังหวัด 1,868 คัน</p>
                    <div>
                        <strong class="text-emerald-900">ข้อเสนอ:</strong>
                        <ul class="list-disc list-inside text-emerald-800 mt-1 pl-2 project-proposals">
                            <li>ติดตามแนวโน้มการเปลี่ยนแปลงจำนวนรถต่อไป</li>
                            <li>ประเมินผลกระทบของมาตรการเป็นระยะ เพื่อพิจารณาว่าจำเป็นต้องมีมาตรการอื่น ๆ เพิ่มเติมหรือไม่</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-4 pt-4 border-t border-emerald-200">
                    <button onclick="generateSummary(this)" class="w-full text-center bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors duration-300 flex items-center justify-center">
                        ✨ สร้างสรุปสำหรับผู้บริหาร
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- AI Summary Modal -->
    <div id="aiSummaryModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl mx-auto p-6 md:p-8 relative transform transition-all duration-300 scale-95">
             <button id="closeModalButton" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-2xl font-bold text-[#047857] mb-4">✨ สรุปสำหรับผู้บริหาร</h2>
            <div id="summaryContent" class="text-gray-700 space-y-4" style="white-space: pre-wrap;">
                <!-- Loading spinner -->
                <div class="flex justify-center items-center h-48">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // Chart.js doughnut chart initialization
        const ctxV4 = document.getElementById('statusChartV4').getContext('2d');
        const statusChartV4 = new Chart(ctxV4, {
            type: 'doughnut',
            data: {
                labels: ['ตามแผน', 'แล้วเสร็จ'],
                datasets: [{
                    label: 'สถานะโครงการ',
                    data: [11, 4],
                    backgroundColor: ['#10B981', '#34D399'],
                    borderColor: ['#FFFFFF', '#FFFFFF'],
                    borderWidth: 4,
                    hoverOffset: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { family: 'Sarabun', size: 14, weight: '600' },
                            color: '#475569', 
                            padding: 20
                        }
                    },
                    tooltip: {
                        titleFont: { family: 'Sarabun', weight: 'bold' },
                        bodyFont: { family: 'Sarabun' },
                        padding: 10,
                        boxPadding: 4,
                    }
                }
            }
        });

        // Gemini API integration script
        const modal = document.getElementById('aiSummaryModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const summaryContent = document.getElementById('summaryContent');
        const spinnerHtml = `<div class="flex justify-center items-center h-48"><div class="spinner"></div></div>`;

        // Function to open the modal
        function showModal() {
            modal.classList.remove('hidden');
            // Animate entrance
            setTimeout(() => modal.querySelector('div > div').classList.add('scale-100'), 10);
        }

        // Function to close the modal
        function closeModal() {
            const modalDiv = modal.querySelector('div > div');
            modalDiv.classList.remove('scale-100');
             setTimeout(() => modal.classList.add('hidden'), 300);
        }

        closeModalButton.addEventListener('click', closeModal);
        // Also close modal if clicking on the background overlay
        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });


        async function generateSummary(buttonElement) {
            // 1. Get project data from the card
            const card = buttonElement.closest('.flex-col');
            const title = card.querySelector('.project-title').innerText;
            const status = card.querySelector('.status-badge').innerText.trim();
            const details = card.querySelector('.project-details').innerText;
            const proposals = card.querySelector('.project-proposals').innerText;
            
            // 2. Show modal with loading spinner
            summaryContent.innerHTML = spinnerHtml;
            showModal();

            // 3. Construct the prompt for Gemini API
            const prompt = `คุณคือผู้ช่วยจัดการโครงการมืออาชีพ โปรดเขียนสรุปสำหรับผู้บริหาร (Executive Summary) ความยาว 1-2 ย่อหน้าสั้นๆ เป็นภาษาไทย จากข้อมูลโครงการต่อไปนี้:

- ชื่อโครงการ: ${title}
- สถานะปัจจุบัน: ${status} (${details.replace('สถานะ:','').trim()})
- ข้อเสนอแนะ/ความคืบหน้า: ${proposals}

โปรดสรุปใจความสำคัญให้กระชับ เข้าใจง่าย และเหมาะสำหรับนำเสนอต่อผู้บริหารระดับสูง`;

            // 4. Call the Gemini API
            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // API key will be provided by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();

                let summaryText = "ไม่สามารถสร้างสรุปได้ในขณะนี้ โปรดลองอีกครั้ง";
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    summaryText = result.candidates[0].content.parts[0].text;
                }
                
                // 5. Display the result
                summaryContent.innerText = summaryText;

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                summaryContent.innerText = "เกิดข้อผิดพลาดในการสร้างสรุป: " + error.message;
            }
        }
    </script>
</body>
</html>
